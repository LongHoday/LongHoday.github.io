<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch s·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="styles.css">
  
</head>
<body>
  <!-- Top Notification -->
  <div class="topbar">
    <div class="container">
      <span>‚ö° Gi·∫£m ƒë·∫øn 50% | Freeship ƒë∆°n t·ª´ 500k | Tr·∫£ g√≥p 0%</span>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="index.html">
        <span class="logo-badge">Tech</span><span class="logo-text">Mall</span>
      </a>

      

      <form class="search-box" action="#" method="get" role="search" aria-label="T√¨m ki·∫øm">
        <input name="q" type="text" placeholder="B·∫°n mu·ªën t√¨m g√¨? (V√≠ d·ª•: iPhone 15, Galaxy S24...)" aria-label="√î t√¨m ki·∫øm">
        <button type="submit" aria-label="T√¨m ki·∫øm">üîç</button>
      </form>

    <nav class="quick-links">
  <a href="#" class="quick-item" aria-label="Tra c·ª©u ƒë∆°n h√†ng">üßæ ƒê∆°n h√†ng</a>
  <a href="cart.html" class="quick-item" aria-label="Gi·ªè h√†ng">üõí Gi·ªè h√†ng</a>

  <!-- N√∫t m·∫∑c ƒë·ªãnh khi ch∆∞a ƒëƒÉng nh·∫≠p -->
  <a href="login.html" id="btnAccount" class="quick-item" aria-label="T√†i kho·∫£n">üë§ T√†i kho·∫£n</a>

  <!-- Panel hi·ªán khi ƒë√£ ƒëƒÉng nh·∫≠p -->
  <div id="userPanel" class="quick-item" style="display:none;">
  üë§ 
  <a id="userName" href="profile.html" style="text-decoration:none; color:inherit;"></a>
  <button id="btnLogout">ƒêƒÉng xu·∫•t</button>
</div>
</nav>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const user = JSON.parse(localStorage.getItem("user"));
  const btnAccount = document.getElementById("btnAccount");
  const userPanel = document.getElementById("userPanel");
  const userName = document.getElementById("userName");
  const btnLogout = document.getElementById("btnLogout");

  if (user && user.full_name) {
    // ·∫®n n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "none";

    // Hi·ªán panel user
    if (userName) userName.textContent = user.full_name;
    if (userPanel) userPanel.style.display = "inline-block";
  } else {
    // N·∫øu kh√¥ng c√≥ user -> hi·ªÉn th·ªã n√∫t ƒëƒÉng nh·∫≠p
    if (btnAccount) btnAccount.style.display = "inline-block";
    if (userPanel) userPanel.style.display = "none";
  }

  // ƒêƒÉng xu·∫•t
  if (btnLogout) {
    btnLogout.addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  }
});
</script>



      <!-- Mobile drawer -->
      <nav class="drawer">
        <ul class="drawer-list">
          <li><a href="#">ƒêi·ªán tho·∫°i</a></li>
          <li><a href="#">Laptop</a></li>
          <li><a href="#">Tablet</a></li>
          <li><a href="#">√Çm thanh</a></li>
          <li><a href="#">ƒê·ªìng h·ªì</a></li>
          <li><a href="#">Ph·ª• ki·ªán</a></li>
         
         
        </ul>
      </nav>
    </div>

    <!-- Category bar (desktop) -->
     <div class="category-bar">
      <div class="container cat-inner">
        <a href="showproduct1.html">ƒêi·ªán tho·∫°i</a>
        <a href="showproduct2.html">Laptop</a>
        <a href="showproduct3.html">ƒê·ªìng h·ªì</a>
        <a href="showproduct4.html">Ph·ª• ki·ªán</a>

      </div>
    </div>
  </header>






<section class="section">
  <div class="container section-head">
    <h2>ƒêi·ªán tho·∫°i</h2>
  </div>

  <div id="phone-grid" class="container product-grid">
    <!-- s·∫£n ph·∫©m render t·ª´ JS -->
  </div>

  <div id="pagination" style="text-align:center; margin-top:20px;">
    <button id="prevBtn" class="btn btn-outline">‚Üê Trang tr∆∞·ªõc</button>
    <span id="pageInfo" style="margin:0 10px; font-weight:bold;"></span>
    <button id="nextBtn" class="btn btn-outline">Trang sau ‚Üí</button>
  </div>
</section>

<script>
let currentPage = 1;
const limit = 6; // s·ªë s·∫£n ph·∫©m m·ªói trang

// G·ªçi API l·∫•y danh s√°ch s·∫£n ph·∫©m
async function fetchPhones(page = 1, limit = 6) {
  try {
    const res = await fetch(
      `http://localhost/ecommerce_api/index.php/api/products?category_id=1&page=${page}&limit=${limit}`
    );
    const data = await res.json();

    const grid = document.getElementById("phone-grid");

    if (!data.success || !data.data || data.data.length === 0) {
      grid.innerHTML = `<p>${data.message || "Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o."}</p>`;
      document.getElementById("nextBtn").style.display = "none";
      return;
    }

    renderProducts(data.data, "phone-grid");

    // C·∫≠p nh·∫≠t th√¥ng tin ph√¢n trang
    document.getElementById("pageInfo").textContent = `Trang ${page}`;

    // X·ª≠ l√Ω hi·ªÉn th·ªã n√∫t ph√¢n trang
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    prevBtn.style.display = (page === 1) ? "none" : "inline-block";
    nextBtn.style.display = (data.data.length < limit) ? "none" : "inline-block";

  } catch (err) {
    console.error("Fetch error:", err);
    document.getElementById("phone-grid").innerHTML = `<p>L·ªói t·∫£i s·∫£n ph·∫©m!</p>`;
  }
}

// Render danh s√°ch s·∫£n ph·∫©m
function renderProducts(products, containerId) {
  const grid = document.getElementById(containerId);
  grid.innerHTML = "";

  products.forEach(prod => {
    const card = document.createElement("div");
    card.className = "product-card";

  // ·∫¢nh
 let thumb = Array.isArray(prod.thumbnail) ? prod.thumbnail[0] : prod.thumbnail;
const pid = prod.product_id || prod.id;

// N·∫øu API tr·∫£ v·ªÅ URL sai (c√≥ "http://localhost/ecommerce_api/...")
if (thumb && thumb.startsWith("http://localhost/ecommerce_api/")) {
  // c·∫Øt l·∫•y t√™n file cu·ªëi c√πng
  thumb = thumb.split("/").pop();
}

let imgUrl;
if (!thumb) {
  // kh√¥ng c√≥ thumbnail ‚Üí b·ªè qua ho·∫∑c set ·∫£nh tr·ªëng
  imgUrl = "";
} else {
  // build l·∫°i theo th∆∞ m·ª•c public/images/{id}/
  imgUrl = `http://localhost/ecommerce_api/public/images/products/${pid}/${thumb}`;
}

const img = document.createElement("img");
img.src = imgUrl;
img.alt = prod.product_name || "";
img.style.width = "150px";

card.appendChild(img);

    // T√™n
    const h3 = document.createElement("h3");
    h3.className = "product-name";
    h3.textContent = prod.product_name;
    card.appendChild(h3);

    // Gi√°
    const priceDiv = document.createElement("div");
    priceDiv.className = "price";
    const strong = document.createElement("strong");
    strong.textContent = Number(prod.price || 0).toLocaleString("vi-VN") + "‚Ç´";
    priceDiv.appendChild(strong);

    if (prod.old_price && prod.old_price > prod.price) {
      const s = document.createElement("s");
      s.textContent = Number(prod.old_price).toLocaleString("vi-VN") + "‚Ç´";
      priceDiv.appendChild(s);
    }
    card.appendChild(priceDiv);

    // N√∫t
    const actions = document.createElement("div");
    actions.className = "actions";

    // N√∫t Mua ngay
    const buyBtn = document.createElement("button");
    buyBtn.className = "btn btn-primary";
    buyBtn.textContent = "Mua ngay";
    buyBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      window.location.href = `product.html?id=${prod.id}`;
    });

    // N√∫t Th√™m gi·ªè
    const addBtn = document.createElement("button");
    addBtn.className = "btn btn-outline";
    addBtn.textContent = "Th√™m gi·ªè";
    addBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      addToCart(prod);
    });

    actions.appendChild(buyBtn);
    actions.appendChild(addBtn);
    card.appendChild(actions);

    // Khi click v√†o card ‚Üí sang trang chi ti·∫øt
    card.addEventListener("click", () => {
      window.location.href = `product.html?id=${prod.id}`;
    });

    grid.appendChild(card);
  });
}

// H√†m th√™m gi·ªè h√†ng
function addToCart(prod) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let existing = cart.find(item => item.id === prod.id);

  if (existing) {
    existing.qty += 1;
  } else {
    cart.push({
      id: prod.id,
      name: prod.product_name,
      price: prod.price,
      thumbnail: prod.thumbnail[0],
      qty: 1
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  alert("ƒê√£ th√™m v√†o gi·ªè!");
}

// X·ª≠ l√Ω s·ª± ki·ªán ph√¢n trang
document.addEventListener("DOMContentLoaded", () => {
  fetchPhones(currentPage, limit);

  document.getElementById("prevBtn").addEventListener("click", () => {
    if (currentPage > 1) {
      currentPage--;
      fetchPhones(currentPage, limit);
    }
  });

  document.getElementById("nextBtn").addEventListener("click", () => {
    currentPage++;
    fetchPhones(currentPage, limit);
  });
});
</script>



   <footer class="footer">
    <div class="container footer-grid">
      <div>
        <a class="logo footer-logo" href="#"><span class="logo-badge">Tech</span><span class="logo-text">Mall</span></a>
        <p class="muted">¬© 2025 TechMall. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        <p class="muted">Hotline: 1800 0000 (Mi·ªÖn ph√≠)</p>
      </div>
      <div>
        <h4>H·ªó tr·ª£ kh√°ch h√†ng</h4>
        <ul class="footer-list">
          <li><a href="#">Trung t√¢m tr·ª£ gi√∫p</a></li>
          <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
          <li><a href="#">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
          <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
        </ul>
      </div>
      <div>
        <h4>V·ªÅ TechMall</h4>
        <ul class="footer-list">
          <li><a href="#">Gi·ªõi thi·ªáu</a></li>
          <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
          <li><a href="#">H·ªá th·ªëng c·ª≠a h√†ng</a></li>
        </ul>
      </div>
      <div>
        <h4>K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
        <div class="socials">
          <a href="#" aria-label="Facebook">üåê</a>
          <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
          <a href="#" aria-label="Zalo">üí¨</a>
        </div>
      </div>
    </div>
  </footer>

</body>
</html>
